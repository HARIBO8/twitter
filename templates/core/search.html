{% extends 'base.html' %}

{% block content %}
  <h2>「{{ query }}」の検索結果</h2>

  {% for tweet in tweets %}
    {% include 'core/tweet_card.html' with tweet=tweet show_controls=True %}
  {% empty %}
    該当する投稿はありません。
  {% endfor %}

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tweetId = btn.dataset.id;
        fetch(`/like/${tweetId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Accept': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          btn.innerHTML = `❤️ ${data.count}`;
        });
      });
    });
  });
</script>

{% endblock %}
