{% extends 'base.html' %}
{% load static %}

{% block title %}„Éõ„Éº„É†{% endblock %}

{% block content %}

<!-- Bootstrap„Éô„Éº„Çπ„ÅÆÊäïÁ®ø„Ç®„É™„Ç¢ -->
<div class="container">
  <div class="row">
    <div class="col-md-8 col-md-offset-2">
      <!-- üîÅ ÊäïÁ®ø„Çø„Ç§„ÉóÂàá„ÇäÊõø„Åà -->
      <div class="text-center" style="margin-bottom: 20px;">
        <a href="{% url 'home' %}?filter=all" class="btn btn-default {% if filter_type == 'all' %}active{% endif %}">All</a>
        <a href="{% url 'home' %}?filter=follow" class="btn btn-default {% if filter_type == 'follow' %}active{% endif %}">Following</a>
      </div>
      {% for tweet in tweets %}
        {% include 'core/tweet_card.html' with tweet=tweet show_controls=False %}
      {% empty %}
        <p>„Åæ„Å†ÊäïÁ®ø„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ</p>
      {% endfor %}
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    document.querySelectorAll('.like-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tweetId = btn.dataset.id;
        fetch(`/like/${tweetId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Accept': 'application/json',
          }
        })
        .then(res => res.json())
        .then(data => {
          btn.innerHTML = `<span class='glyphicon glyphicon-heart'></span> ${data.count}‰ª∂`;
        });
      });
    });

    document.querySelectorAll('.retweet-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tweetId = btn.dataset.id;
        fetch(`/retweet_toggle/${tweetId}/`, {
          method: 'POST',
          headers: {
            'X-CSRFToken': '{{ csrf_token }}',
            'Accept': 'application/json',
          }
        })
        .then(res => res.json())
        .then(data => {
          btn.innerHTML = `<span class='glyphicon glyphicon-retweet'></span> ${data.count}‰ª∂`;
        });
      });
    });

    document.querySelectorAll('.reply-btn').forEach(btn => {
      btn.addEventListener('click', () => {
        const tweetId = btn.dataset.id;
        window.location.href = `/reply/${tweetId}/`;
      });
    });
  });
</script>

{% endblock %}